<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="RuangJahit hadir untuk membantu Anda dalam menemukan jasa penjahit terbaik dan
    memberikan ruang untuk jasa penjahit agar dapat lebih dikenal oleh banyak orang.">
    <meta name="theme-color" content="#FF8A00"/>   
    <meta name="keywords" content="jasa jahit, produk lokal">
    <link rel="apple-touch-icon" href="/icons/icon-192x192.png">
    <link rel="manifest" href="./app.webmanifest">
    <link rel="icon" href="./ruangjahit.png">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>
    <title>RuangJahit</title>
</head>
<body>
    <app-bar style="display: none;"></app-bar>
    <app-bar_user style="display: none;"></app-bar_user>
    <app-bar-tailor style="display: none;"></app-bar-tailor>
    <main id="mainContent"></main>
    <footer-bar></footer-bar>
    <script>
        // Login
        function Login() {
                let btnLogin = document.getElementById("btn-login");
                let username = document.getElementById("username");
                let password = document.getElementById("password");
    
                let data = JSON.stringify({
                    'username': username.value,
                    'password': password.value,
                });
    
                let url = "https://backend-ruangjahit-production.up.railway.app/api/login";
    
                fetch(url, {
                    method: 'POST',
                    headers: {
                        'Accept': 'application/json',
                        'Content-type': 'application/json',
                    },
                    body: data
                })
                .then(function(response) {
                    return response.json().then(function(data) {
                        console.log(response.status);
                        if (response.status == 200) {
                            swal({
                                title: "Login Success!",
                                text: "",
                                icon: "success",
                                button: "OK",
                            })
                            // alert('Login Success, Selamat Datang! ' + username.value);
                            window.location = "#/user-home";
                            username.value = "";
                            password.value = "";
                            localStorage.setItem('token', data.data.token);
                        } else {
                            swal({
                                title: "Login Failed!",
                                text: "Username atau Password Salah!",
                                icon: "error",
                                button: "OK",
                            })
                        }
                    });
                })
                .catch(function(error) {
                    swal({
                        title: "Login Failed!",
                        text: "Username atau Password Salah!",
                        icon: "error",
                        button: "OK",
                    })
                });
            }
        // Regis
        function Registration() {
        const btnRegis = document.getElementById('btn-regis');
        const name = document.getElementById('name');
        const username = document.getElementById('username');
        const first_address = document.getElementById('first_address');
        const first_phone = document.getElementById('first_phone');
        const province_id = document.getElementById('province_id');
        const regency_id = document.getElementById('regency_id');
        const zip_code = document.getElementById('zip_code');
        const email = document.getElementById('email');
        const password = document.getElementById('password');
        const password_confirmation = document.getElementById('password_confirmation');
    
        const data = JSON.stringify({
            name: name.value,
            username: username.value,
            email: email.value,
            password: password.value,
            password_confirmation: password_confirmation.value,
            first_address: first_address.value,
            province_id: province_id.value,
            regency_id: regency_id.value,
            zip_code: zip_code.value,
            first_phone: first_phone.value,
        });
        const url = 'https://backend-ruangjahit-production.up.railway.app/api/register';
        fetch(url, {
            method: 'POST',
            headers: {
            Accept: 'application/json',
            'Content-type': 'application/json',
            },
            body: data,
        }).then((response) => response.json().then((data) => {
            console.log(response.status);
            if (response.status == 200) {
            swal({
                title: "Registrasi Berhasil!",
                text: "",
                icon: "success",
                button: "OK",
            })
            // alert('Data Berhasil Disimpan!');
            window.location = "#/sign-in";
            name.value = '';
            username.value = '';
            email.value = '';
            password.value = '';
            password_confirmation.value = '';
            first_address.value = '';
            province_id.value = '';
            regency_id.value = '';
            zip_code.value = '';
            first_phone.value = '';
            } else {
            console.log(data);
            swal({
                title: "Registrasi Gagal!",
                text: "Terdapat data yang tidak valid!",
                icon: "error",
                button: "OK",
            })
            }
        })).catch((error) => {
            swal({
                title: "Registrasi Gagal!",
                text: "Terdapat data yang tidak valid!",
                icon: "error",
                button: "OK",
            })
        });
        }
    
        // Logout
        const Logout = () => {
        // let key = JSON.stringify(localStorage.getItem('token'));
    
        //     let token = JSON.parse(key);
            token = localStorage.getItem('token');
            console.log(token);
    
            fetch('https://backend-ruangjahit-production.up.railway.app/api/logout', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Accept': 'application/json',
                    'Authorization': `Bearer ${token}`,
                },
            })
            .then((response) => response.json().then((data) => {
                console.log(response.status);
                if (response.status == 200) {
                    swal({
                        title: "Logout Success!",
                        text: "",
                        icon: "success",
                        button: "OK",
                    })
                    window.location = "#/sign-in";
                    localStorage.removeItem('token');
                } else {
                    swal({
                        title: "Logout Failed!",
                        text: "Terjadi Kesalahan!",
                        icon: "error",
                        button: "OK",
                    })
                }
            }))
        };
        </script>
</body>
</html>